<nav class="navbar navbar-expand-lg navbar-brand-custom sticky-top">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center gap-2" href="{% url 'landing' %}">
      <div class="brand-icon">
        <i class="bi bi-graph-up-arrow"></i>
      </div>
      <span class="brand-text">FinanceTracker</span>
    </a>

    <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto align-items-lg-center gap-1">

        {% if user.is_authenticated %}
          <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}" href="{% url 'dashboard' %}">
              <i class="bi bi-grid me-1"></i>Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if 'expense' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'expense_list' %}">
              <i class="bi bi-arrow-down-circle me-1"></i>Expenses
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if 'income' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'income_list' %}">
              <i class="bi bi-arrow-up-circle me-1"></i>Income
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if 'category' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'category_list' %}">
              <i class="bi bi-tags me-1"></i>Categories
            </a>
          </li>

          <!-- Dark Mode Toggle -->
          <li class="nav-item">
            <button class="btn btn-sm nav-icon-btn ms-1" id="darkModeToggle" title="Toggle dark mode">
              <i class="bi bi-{% if dark_mode %}sun{% else %}moon{% endif %}"></i>
            </button>
          </li>

          <!-- User Dropdown -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center gap-2" href="#" data-bs-toggle="dropdown">
              {% if user.profile.profile_picture %}
                <img src="{{ user.profile.profile_picture.url }}" class="rounded-circle" width="28" height="28" alt="avatar" style="object-fit:cover;">
              {% else %}
                <div class="nav-avatar">{{ user.username|first|upper }}</div>
              {% endif %}
              <span class="d-none d-lg-inline">{{ user.first_name|default:user.username }}</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="{% url 'profile' %}"><i class="bi bi-person me-2"></i>Profile</a></li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <form method="post" action="{% url 'logout' %}">
                  {% csrf_token %}
                  <button type="submit" class="dropdown-item text-danger">
                    <i class="bi bi-box-arrow-right me-2"></i>Logout
                  </button>
                </form>
              </li>
            </ul>
          </li>

        {% else %}
          <li class="nav-item">
            <a class="nav-link" href="{% url 'login' %}">Login</a>
          </li>
          <li class="nav-item">
            <a class="btn btn-primary btn-sm px-3 ms-2" href="{% url 'register' %}">
              Get Started
            </a>
          </li>
        {% endif %}

      </ul>
    </div>
  </div>
</nav>
